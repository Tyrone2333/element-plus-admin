<!doctype html>
<html lang='en'>
<head>
    <meta charset='UTF-8'>
    <meta name='viewport'
          content='width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0'>
    <meta http-equiv='X-UA-Compatible' content='ie=edge'>
    <title>Document</title>
    <script src='https://unpkg.com/vue@next'></script>
    <style>
        .child {
            background-color: #f0f0f0;
            padding: 10px;
        }

        h4 {
            margin: 0;
        }
    </style>
</head>
<body>
<div id='app'>
    <h3>vue3自定义组件的v-model</h3>
    <p>msg: {{msg}}</p>
    <div class='checkbox-item'>
        <span>转换中划线: </span>
        <input type='checkbox' v-model='transMiddleDash'>
    </div>
    <div class='checkbox-item'>
        <span>转换空格: </span>
        <input type='checkbox' v-model='transSpace'>
    </div>
    <hr>
    <p>驼峰: {{underlineToHump(msg)}}</p>
    <p>大驼峰: {{underlineToBigHump(msg)}}</p>
    <p>下划线: {{humpToUnderline(msg)}}</p>
    <p>大写下划线: {{toCapitalUnderline(msg)}}</p>
    <p>中划线: {{humpToMiddleLine(msg)}}</p>

    <div class='child'>
        <h4>需要转换的变量名</h4>
        <input type='text' v-model='msg2' @input='handleInput'>
        <!--<custom-input v-model:mv='msg' :transMiddleDash='transMiddleDash'></custom-input>-->
        <!-- <custom-input :model-value="msg" @update:model-value="msg = $event"></custom-input> -->
    </div>

</div>

<script>
    const App = {
        data() {
            return {
                msg: 'fooBar',
                count: 0,
                transMiddleDash: true,
                transSpace: true,
            }
        },
        computed: {
            msg2: {
                get() {
                    return this.msg
                },
                set(v) {
                    let t = v
                    if (this.transSpace) {
                        t = v.replaceAll(' ', '_')
                    }
                    if (this.transMiddleDash) {
                        t = t.replaceAll('-', '_')
                    }
                    this.msg = t
                    // this.$emit('update:mv', v.replaceAll(' ', '_'))
                },
            },
        },
        watch: {
            transMiddleDash() {
                console.log(1111111)
            },
        },
        methods: {
            handleInput(v) {
                console.log('handleInput', v.target.value)
            },
            // 下划线转驼峰
            underlineToHump(s) {
                var a = s.split("_")
                var result = a[0]
                for (var i = 1; i < a.length; i++) {
                    result = result + a[i].slice(0, 1).toUpperCase() + a[i].slice(1)
                }
                return result
            },
            // 下划线转驼峰
            underlineToBigHump(s) {
                let str = this.underlineToHump(s)
                return str.replace(str[0], str[0].toUpperCase())
            },
            // 驼峰转下划线
            humpToUnderline(str) {
                return str.replace(/([A-Z])/g, "_$1").toLowerCase()
            },
            // 驼峰转下划线
            humpToMiddleLine(str) {
                return str.replace(/([A-Z])/g, "-$1").toLowerCase()
            },
            // 大写
            toCapitalUnderline(str) {
                return str.replace(/([A-Z])/g, "_$1").toUpperCase()
            },
        },
    }

    const app = Vue.createApp(App)

    app.component('custom-input', {
        props: ['mv', 'transMiddleDash'],
        computed: {
            value: {
                get() {
                    return this.mv
                },
                set(v) {
                    this.$emit('update:mv', v.replaceAll(' ', '_'))
                },
            },
        },
        template: `
          <input v-model='value'>
        `,
    })

    app.mount('#app')
</script>
</body>
</html>
